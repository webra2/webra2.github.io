(()=>{"use strict";var t={898:t=>{t.exports=t=>!!t&&("symbol"==typeof Symbol.observable&&"function"==typeof t[Symbol.observable]?t===t[Symbol.observable]():"function"==typeof t["@@observable"]&&t===t["@@observable"]())},467:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;const i=s(381);let n=i.DefaultSerializer;e.registerSerializer=function(t){n=i.extendSerializer(n,t)},e.deserialize=function(t){return n.deserialize(t)},e.serialize=function(t){return n.serialize(t)}},381:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0,e.extendSerializer=function(t,e){const s=t.deserialize.bind(t),i=t.serialize.bind(t);return{deserialize:t=>e.deserialize(t,s),serialize:t=>e.serialize(t,i)}};const s=t=>Object.assign(Error(t.message),{name:t.name,stack:t.stack}),i=t=>({__error_marker:"$$error",message:t.message,name:t.name,stack:t.stack});e.DefaultSerializer={deserialize(t){return(e=t)&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker?s(t):t;var e},serialize:t=>t instanceof Error?i(t):t}},258:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")},180:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;const i=s(258);e.isTransferDescriptor=function(t){return t&&"object"==typeof t&&t[i.$transferable]},e.Transfer=function(t,e){if(!e){if(!(s=t)||"object"!=typeof s)throw Error();e=[t]}var s;return{[i.$transferable]:!0,send:t,transferables:e}}},229:(t,e)=>{var s,i;Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,(i=e.MasterMessageType||(e.MasterMessageType={})).cancel="cancel",i.run="run",(s=e.WorkerMessageType||(e.WorkerMessageType={})).error="error",s.init="init",s.result="result",s.running="running",s.uncaughtError="uncaughtError"},447:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={isWorkerRuntime:function(){const t="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||t)},postMessageToMaster:function(t,e){self.postMessage(t,e)},subscribeToMasterMessages:function(t){const e=e=>{t(e.data)};return self.addEventListener("message",e),()=>{self.removeEventListener("message",e)}}}},934:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,h){function r(t){try{u(i.next(t))}catch(t){h(t)}}function a(t){try{u(i.throw(t))}catch(t){h(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}u((i=i.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const h=n(s(898)),r=s(467),a=s(180),u=s(229),o=n(s(447));var l=s(467);Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var d=s(180);Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return d.Transfer}}),e.isWorkerRuntime=o.default.isWorkerRuntime;let c=!1;const f=new Map,p=t=>t&&t.type===u.MasterMessageType.run,m=t=>h.default(t)||function(t){return t&&"object"==typeof t&&"function"==typeof t.subscribe}(t);function g(t){return a.isTransferDescriptor(t)?{payload:t.send,transferables:t.transferables}:{payload:t,transferables:void 0}}function I(t,e){const{payload:s,transferables:i}=g(e),n={type:u.WorkerMessageType.error,uid:t,error:r.serialize(s)};o.default.postMessageToMaster(n,i)}function b(t,e,s){const{payload:i,transferables:n}=g(s),h={type:u.WorkerMessageType.result,uid:t,complete:!!e||void 0,payload:i};o.default.postMessageToMaster(h,n)}function k(t){try{const e={type:u.WorkerMessageType.uncaughtError,error:r.serialize(t)};o.default.postMessageToMaster(e)}catch(e){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",e,"\nOriginal error:",t)}}function S(t,e,s){return i(this,void 0,void 0,(function*(){let i;try{i=e(...s)}catch(e){return I(t,e)}const n=m(i)?"observable":"promise";if(function(t,e){const s={type:u.WorkerMessageType.running,uid:t,resultType:e};o.default.postMessageToMaster(s)}(t,n),m(i)){const e=i.subscribe((e=>b(t,!1,r.serialize(e))),(e=>{I(t,r.serialize(e)),f.delete(t)}),(()=>{b(t,!0),f.delete(t)}));f.set(t,e)}else try{const e=yield i;b(t,!0,r.serialize(e))}catch(e){I(t,r.serialize(e))}}))}e.expose=function(t){if(!o.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(c)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(c=!0,"function"==typeof t)o.default.subscribeToMasterMessages((e=>{p(e)&&!e.method&&S(e.uid,t,e.args.map(r.deserialize))})),function(){const t={type:u.WorkerMessageType.init,exposed:{type:"function"}};o.default.postMessageToMaster(t)}();else{if("object"!=typeof t||!t)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${t}`);o.default.subscribeToMasterMessages((e=>{p(e)&&e.method&&S(e.uid,t[e.method],e.args.map(r.deserialize))})),function(t){const e={type:u.WorkerMessageType.init,exposed:{type:"module",methods:t}};o.default.postMessageToMaster(e)}(Object.keys(t).filter((e=>"function"==typeof t[e])))}o.default.subscribeToMasterMessages((t=>{if((e=t)&&e.type===u.MasterMessageType.cancel){const e=t.uid,s=f.get(e);s&&(s.unsubscribe(),f.delete(e))}var e}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&o.default.isWorkerRuntime()&&(self.addEventListener("error",(t=>{setTimeout((()=>k(t.error||t)),250)})),self.addEventListener("unhandledrejection",(t=>{const e=t.reason;e&&"string"==typeof e.message&&setTimeout((()=>k(e)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&o.default.isWorkerRuntime()&&(process.on("uncaughtException",(t=>{setTimeout((()=>k(t)),250)})),process.on("unhandledRejection",(t=>{t&&"string"==typeof t.message&&setTimeout((()=>k(t)),250)})))}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var h=e[i]={exports:{}};return t[i].call(h.exports,h,h.exports,s),h.exports}s.m=t,s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.f={},s.e=t=>Promise.all(Object.keys(s.f).reduce(((e,i)=>(s.f[i](t,e),e)),[])),s.u=t=>"workerVxl.js?v=0.55.6",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{var t={348:1};s.f.i=(e,i)=>{t[e]||importScripts(s.p+s.u(e))};var e=self.webpackChunkra2ts_client=self.webpackChunkra2ts_client||[],i=e.push.bind(e);e.push=e=>{var[n,h,r]=e;for(var a in h)s.o(h,a)&&(s.m[a]=h[a]);for(r&&r(s);n.length;)t[n.pop()]=1;i(e)}})();var i={};(()=>{s.r(i);var t=s(934);const e=t.expose,n=(t.registerSerializer,t.Transfer),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function r(t,e){return t>0?parseInt(t/e.oldMax*e.newMax,10):parseInt(t/e.oldMin*e.newMin,10)}function a(t,e){return parseInt(t>0?t*e.newMax:t*e.newMin,10)}function u(t,e){return t>0?t/e.oldMax:t/e.oldMin}function o(t){if("32f"!=t&&"64"!=t&&(parseInt(t,10)<"8"||parseInt(t,10)>"53"))throw new Error("Invalid bit depth.")}function l(t,e,s){if("8"==t){let t=s?-128:128;for(let s=0,i=e.length;s<i;s++)e[s]=e[s]+=t}}const d=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],c=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function f(t,e=256){let s={index:0,predicted:0,step:7},i=new Int16Array(2*t.length),n=[],h=0,r=t.length,a=0;for(;r>0;){let u=Math.min(r,e);for(let e=0;e<u;e++)n.push(t[a]),a++;let o=m(n,s);i.set(o,h),h+=o.length,n=[],r-=e}return i.slice(0,h)}function p(t,e){let s=function(t,e){g(t,e);let s=[];return s.push(255&t),s.push(t>>8&255),s.push(e.index),s.push(0),s}(t[0],e);for(let i=3,n=t.length;i<n;i+=2){let n=g(t[i],e),h=g(t[i+1],e);s.push(h<<4|n)}return s}function m(t,e){var s;e.predicted=(s=t[1]<<8|t[0])>32767?s-65536:s,e.index=t[2],e.step=c[e.index];let i=[e.predicted];for(let s=4,n=t.length;s<n;s++){let n=t[s],h=n>>4,r=h<<4^n;i.push(I(r,e)),i.push(I(h,e))}return i}function g(t,e){let s=t-e.predicted,i=0;s>=0?i=0:(i=8,s=-s);let n=c[e.index],h=n>>3;return s>n&&(i|=4,s-=n,h+=n),n>>=1,s>n&&(i|=2,s-=n,h+=n),n>>=1,s>n&&(i|=1,h+=n),function(t,e,s){8&t?s.predicted-=e:s.predicted+=e,s.predicted<-32768?s.predicted=-32768:s.predicted>32767&&(s.predicted=32767),s.index+=d[7&t],s.index<0?s.index=0:s.index>88&&(s.index=88)}(i,h,e),i}function I(t,e){let s=0;return 4&t&&(s+=e.step),2&t&&(s+=e.step>>1),1&t&&(s+=e.step>>2),s+=e.step>>3,8&t&&(s=-s),e.predicted+=s,e.predicted>32767?e.predicted=32767:e.predicted<-32768&&(e.predicted=-32768),function(t,e){e.index+=d[t],e.index<0?e.index=0:e.index>88&&(e.index=88),e.step=c[e.index]}(t,e),e.predicted}const b=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function k(t){let e,s=~(t=-32768==t?-32767:t)>>8&128;if(s||(t*=-1),t>32635&&(t=32635),t>=256){let s=b[t>>8&127];e=s<<4|t>>s+3&15}else e=t>>4;return 85^e^s}function S(t){let e=0;0!=(128&(t^=85))&&(t&=-129,e=-1);let s=4+((240&t)>>4),i=0;return i=4!=s?1<<s|(15&t)<<s-4|1<<s-5:t<<1|1,i=0===e?i:-i,8*i*-1}const w=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],_=[0,132,396,924,1980,4092,8316,16764];function y(t){let e,s,i,n;return e=t>>8&128,0!=e&&(t=-t),(t+=132)>32635&&(t=32635),s=w[t>>7&255],i=t>>s+3&15,n=~(e|s<<4|i),n}function C(t){let e,s,i,n;return e=128&(t=~t),s=t>>4&7,i=15&t,n=_[s]+(i<<s+3),0!=e&&(n=-n),n}function M(t,e,s=0,i=t.length){for(let n=s;n<i;n+=e)T(t,e,n)}function T(t,e,s){e--;for(let i=0;i<e;i++){let n=t[s+i];t[s+i]=t[s+e],t[s+e]=n,e--}}function L(t,e,s=0){let i=0,n=t.length;for(;i<n;){let n=t.codePointAt(i);if(n<128)e[s]=n,s++;else{let t=0,h=0;for(n<=2047?(t=1,h=192):n<=65535?(t=2,h=224):n<=1114111&&(t=3,h=240,i++),e[s]=(n>>6*t)+h,s++;t>0;)e[s]=128|n>>6*(t-1)&63,s++,t--}i++}return s}const x=new Array(8).fill(0).map(((t,e)=>Math.pow(2,8*e)));class z{constructor(t,e=!1){this.bits=t,this.offset=Math.ceil(t/8),this.max=Math.pow(2,t)-1,this.min=0,this.unpack=this.unpack_,e&&(this.max=Math.pow(2,t)/2-1,this.min=-this.max-1,this.unpack=this.unpackSigned_)}pack(t,e,s=0){e=this.clamp_(Math.round(e));for(let i=0,n=this.offset;i<n;i++)t[s]=255&Math.floor(e/x[i]),s++;return s}unpack_(t,e=0){let s=0;for(let i=0;i<this.offset;i++)s+=t[e+i]*x[i];return s}unpackSigned_(t,e=0){return this.sign_(this.unpack_(t,e))}clamp_(t){return t>this.max?this.max:t<this.min?this.min:t}sign_(t){return t>this.max&&(t-=2*this.max+2),t}}class P{constructor(t,e){this.offset=Math.ceil((t+e)/8),this.ebits=t,this.fbits=e,this.bias=(1<<t-1)-1,this.biasP2=Math.pow(2,this.bias+1),this.ebitsFbits=t+e,this.fbias=Math.pow(2,-(8*this.offset-1-t))}pack(t,e,s){Math.abs(e)>this.biasP2-2*this.ebitsFbits&&(e=e<0?-1/0:1/0);let i=((e=+e)||1/e)<0||e<0?1:0;e=Math.abs(e);let n=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),h=v(e/Math.pow(2,n)*Math.pow(2,this.fbits));return e!=e?(h=Math.pow(2,this.fbits-1),n=(1<<this.ebits)-1):0!==e&&(e>=Math.pow(2,1-this.bias)?(h/Math.pow(2,this.fbits)>=2&&(n+=1,h=1),n>this.bias?(n=(1<<this.ebits)-1,h=0):(n+=this.bias,h=v(h)-Math.pow(2,this.fbits))):(h=v(e/Math.pow(2,1-this.bias-this.fbits)),n=0)),this.packFloatBits_(t,s,i,n,h)}unpack(t,e){let s,i=(1<<this.ebits)-1,n="";for(let s=this.offset-1;s>=0;s--){let i=t[s+e].toString(2);n+="00000000".substring(i.length)+i}let h="1"==n.charAt(0)?-1:1;n=n.substring(1);let r=parseInt(n.substring(0,this.ebits),2);return n=n.substring(this.ebits),r==i?0!==parseInt(n,2)?NaN:h*(1/0):(0===r?(r+=1,s=parseInt(n,2)):s=parseInt("1"+n,2),h*s*this.fbias*Math.pow(2,r-this.bias))}packFloatBits_(t,e,s,i,n){let h=[];h.push(s);for(let t=this.ebits;t>0;t-=1)h[t]=i%2?1:0,i=Math.floor(i/2);let r=h.length;for(let t=this.fbits;t>0;t-=1)h[r+t]=n%2?1:0,n=Math.floor(n/2);let a=h.join(""),u=this.offset+e-1,o=e;for(;u>=e;)t[u]=parseInt(a.substring(0,8),2),a=a.substring(8),u--,o++;return o}}function v(t){let e=Math.floor(t),s=t-e;return s<.5?e:s>.5||e%2?e+1:e}function F(t,e=0,s=t.length){return function(t,e=0,s=t.length){let i="";for(let n=e;n<s;){let e=128,s=191,h=!1,r=t[n++];if(r>=0&&r<=127)i+=String.fromCharCode(r);else{let a=0;r>=194&&r<=223?a=1:r>=224&&r<=239?(a=2,224===t[n]&&(e=160),237===t[n]&&(s=159)):r>=240&&r<=244?(a=3,240===t[n]&&(e=144),244===t[n]&&(s=143)):h=!0,r&=(1<<8-a-1)-1;for(let i=0;i<a;i++)(t[n]<e||t[n]>s)&&(h=!0),r=r<<6|63&t[n],n++;h?i+=String.fromCharCode(65533):r<=65535?i+=String.fromCharCode(r):(r-=65536,i+=String.fromCharCode(55296+(r>>10&1023),56320+(1023&r)))}}return i}(t,e,s)}function D(t){let e=[];return L(t,e),e}function B(t,e,s=0){return L(t,e,s)}function A(t,e,s,i=0){let n=X((e=e||{}).bits,e.fp,e.signed),h=Math.ceil(e.bits/8),r=0,a=i;for(let e=t.length;r<e;r++)i=n.pack(s,t[r],i);return e.be&&M(s,h,a,i),i}function U(t,e,s,i=0,n=t.length){let h=X((e=e||{}).bits,e.fp,e.signed);if(n=function(t,e,s,i){return s-(s-e)%i}(0,i,n,h.offset),e.be){let r=function(t){return new Uint8Array(t)}(t);e.be&&M(r,h.offset,i,n),j(r,s,i,n,h)}else j(t,s,i,n,h)}function R(t,e,s,i=0){return A([t],e,s,i)}function O(t,e){let s=[];return R(t,e,s,0),s}function E(t,e,s=0){let i=[];return U(t,e,i,s,s+Math.ceil(e.bits/8)),i[0]}function j(t,e,s,i,n){let h=n.offset;for(let r=0,a=s;a<i;a+=h,r++)e[r]=n.unpack(t,a)}function X(t,e,s){return e&&32==t?new P(8,23):e&&64==t?new P(11,52):new z(t,s)}class N extends class{constructor(){this.container="",this.chunkSize=0,this.format="",this.signature=null,this.head=0,this.uInt32={bits:32,be:!1},this.supported_containers=["RIFF","RIFX"]}setSignature(t){if(this.head=0,this.container=this.readString(t,4),-1===this.supported_containers.indexOf(this.container))throw Error("Not a supported format.");this.uInt32.be="RIFX"===this.container,this.chunkSize=this.readUInt32(t),this.format=this.readString(t,4),this.signature={chunkId:this.container,chunkSize:this.chunkSize,format:this.format,subChunks:this.getSubChunksIndex_(t)}}findChunk(t,e=!1){let s=this.signature.subChunks,i=[];for(let n=0;n<s.length;n++)if(s[n].chunkId==t){if(!e)return s[n];i.push(s[n])}return"LIST"==t&&i.length?i:null}readString(t,e){let s="";return s=F(t,this.head,this.head+e),this.head+=e,s}readUInt32(t){let e=E(t,this.uInt32,this.head);return this.head+=4,e}getSubChunksIndex_(t){let e=[],s=this.head;for(;s<=t.length-8;)e.push(this.getSubChunkIndex_(t,s)),s+=8+e[e.length-1].chunkSize,s=s%2?s+1:s;return e}getSubChunkIndex_(t,e){let s={chunkId:this.getChunkId_(t,e),chunkSize:this.getChunkSize_(t,e)};if("LIST"==s.chunkId)s.format=F(t,e+8,e+12),this.head+=4,s.subChunks=this.getSubChunksIndex_(t);else{let t=s.chunkSize%2?s.chunkSize+1:s.chunkSize;this.head=e+8+t,s.chunkData={start:e+8,end:this.head}}return s}getChunkId_(t,e){return this.head+=4,F(t,e,e+4)}getChunkSize_(t,e){return this.head+=4,E(t,this.uInt32,e+4)}}{constructor(){super(),this.supported_containers.push("RF64"),this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},this.iXML={chunkId:"",chunkSize:0,value:""},this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},this.LIST=[],this.junk={chunkId:"",chunkSize:0,chunkData:[]},this._PMX={chunkId:"",chunkSize:0,value:""},this.uInt16={bits:16,be:!1,signed:!1,fp:!1}}fromBuffer(t,e=!0){if(this.clearHeaders(),this.setSignature(t),this.uInt16.be=this.uInt32.be,"WAVE"!=this.format)throw Error('Could not find the "WAVE" format identifier');this.readDs64Chunk_(t),this.readFmtChunk_(t),this.readFactChunk_(t),this.readBextChunk_(t),this.readiXMLChunk_(t),this.readCueChunk_(t),this.readSmplChunk_(t),this.readDataChunk_(t,e),this.readJunkChunk_(t),this.readLISTChunk_(t),this.read_PMXChunk_(t)}clearHeaders(){let t=new N;Object.assign(this.fmt,t.fmt),Object.assign(this.fact,t.fact),Object.assign(this.cue,t.cue),Object.assign(this.smpl,t.smpl),Object.assign(this.bext,t.bext),Object.assign(this.iXML,t.iXML),Object.assign(this.ds64,t.ds64),Object.assign(this.data,t.data),this.LIST=[],Object.assign(this.junk,t.junk),Object.assign(this._PMX,t._PMX)}readFmtChunk_(t){let e=this.findChunk("fmt ");if(!e)throw Error('Could not find the "fmt " chunk');this.head=e.chunkData.start,this.fmt.chunkId=e.chunkId,this.fmt.chunkSize=e.chunkSize,this.fmt.audioFormat=this.readUInt16_(t),this.fmt.numChannels=this.readUInt16_(t),this.fmt.sampleRate=this.readUInt32(t),this.fmt.byteRate=this.readUInt32(t),this.fmt.blockAlign=this.readUInt16_(t),this.fmt.bitsPerSample=this.readUInt16_(t),this.readFmtExtension_(t)}readFmtExtension_(t){this.fmt.chunkSize>16&&(this.fmt.cbSize=this.readUInt16_(t),this.fmt.chunkSize>18&&(this.fmt.validBitsPerSample=this.readUInt16_(t),this.fmt.chunkSize>20&&(this.fmt.dwChannelMask=this.readUInt32(t),this.fmt.subformat=[this.readUInt32(t),this.readUInt32(t),this.readUInt32(t),this.readUInt32(t)])))}readFactChunk_(t){let e=this.findChunk("fact");e&&(this.head=e.chunkData.start,this.fact.chunkId=e.chunkId,this.fact.chunkSize=e.chunkSize,this.fact.dwSampleLength=this.readUInt32(t))}readCueChunk_(t){let e=this.findChunk("cue ");if(e){this.head=e.chunkData.start,this.cue.chunkId=e.chunkId,this.cue.chunkSize=e.chunkSize,this.cue.dwCuePoints=this.readUInt32(t);for(let e=0;e<this.cue.dwCuePoints;e++)this.cue.points.push({dwName:this.readUInt32(t),dwPosition:this.readUInt32(t),fccChunk:this.readString(t,4),dwChunkStart:this.readUInt32(t),dwBlockStart:this.readUInt32(t),dwSampleOffset:this.readUInt32(t)})}}readSmplChunk_(t){let e=this.findChunk("smpl");if(e){this.head=e.chunkData.start,this.smpl.chunkId=e.chunkId,this.smpl.chunkSize=e.chunkSize,this.smpl.dwManufacturer=this.readUInt32(t),this.smpl.dwProduct=this.readUInt32(t),this.smpl.dwSamplePeriod=this.readUInt32(t),this.smpl.dwMIDIUnityNote=this.readUInt32(t),this.smpl.dwMIDIPitchFraction=this.readUInt32(t),this.smpl.dwSMPTEFormat=this.readUInt32(t),this.smpl.dwSMPTEOffset=this.readUInt32(t),this.smpl.dwNumSampleLoops=this.readUInt32(t),this.smpl.dwSamplerData=this.readUInt32(t);for(let e=0;e<this.smpl.dwNumSampleLoops;e++)this.smpl.loops.push({dwName:this.readUInt32(t),dwType:this.readUInt32(t),dwStart:this.readUInt32(t),dwEnd:this.readUInt32(t),dwFraction:this.readUInt32(t),dwPlayCount:this.readUInt32(t)})}}readDataChunk_(t,e){let s=this.findChunk("data");if(!s)throw Error('Could not find the "data" chunk');this.data.chunkId="data",this.data.chunkSize=s.chunkSize,e&&(this.data.samples=t.slice(s.chunkData.start,s.chunkData.end))}readBextChunk_(t){let e=this.findChunk("bext");e&&(this.head=e.chunkData.start,this.bext.chunkId=e.chunkId,this.bext.chunkSize=e.chunkSize,this.bext.description=this.readString(t,256),this.bext.originator=this.readString(t,32),this.bext.originatorReference=this.readString(t,32),this.bext.originationDate=this.readString(t,10),this.bext.originationTime=this.readString(t,8),this.bext.timeReference=[this.readUInt32(t),this.readUInt32(t)],this.bext.version=this.readUInt16_(t),this.bext.UMID=this.readString(t,64),this.bext.loudnessValue=this.readUInt16_(t),this.bext.loudnessRange=this.readUInt16_(t),this.bext.maxTruePeakLevel=this.readUInt16_(t),this.bext.maxMomentaryLoudness=this.readUInt16_(t),this.bext.maxShortTermLoudness=this.readUInt16_(t),this.bext.reserved=this.readString(t,180),this.bext.codingHistory=this.readString(t,this.bext.chunkSize-602))}readiXMLChunk_(t){let e=this.findChunk("iXML");e&&(this.head=e.chunkData.start,this.iXML.chunkId=e.chunkId,this.iXML.chunkSize=e.chunkSize,this.iXML.value=F(t,this.head,this.head+this.iXML.chunkSize))}readDs64Chunk_(t){let e=this.findChunk("ds64");if(e)this.head=e.chunkData.start,this.ds64.chunkId=e.chunkId,this.ds64.chunkSize=e.chunkSize,this.ds64.riffSizeHigh=this.readUInt32(t),this.ds64.riffSizeLow=this.readUInt32(t),this.ds64.dataSizeHigh=this.readUInt32(t),this.ds64.dataSizeLow=this.readUInt32(t),this.ds64.originationTime=this.readUInt32(t),this.ds64.sampleCountHigh=this.readUInt32(t),this.ds64.sampleCountLow=this.readUInt32(t);else if("RF64"==this.container)throw Error('Could not find the "ds64" chunk')}readLISTChunk_(t){let e=this.findChunk("LIST",!0);if(null!==e)for(let s=0;s<e.length;s++){let i=e[s];this.LIST.push({chunkId:i.chunkId,chunkSize:i.chunkSize,format:i.format,subChunks:[]});for(let e=0;e<i.subChunks.length;e++)this.readLISTSubChunks_(i.subChunks[e],i.format,t)}}readLISTSubChunks_(t,e,s){"adtl"==e?["labl","note","ltxt"].indexOf(t.chunkId)>-1&&this.readLISTadtlSubChunks_(s,t):"INFO"==e&&this.readLISTINFOSubChunks_(s,t)}readLISTadtlSubChunks_(t,e){this.head=e.chunkData.start;let s={chunkId:e.chunkId,chunkSize:e.chunkSize,dwName:this.readUInt32(t)};"ltxt"==e.chunkId?(s.dwSampleLength=this.readUInt32(t),s.dwPurposeID=this.readUInt32(t),s.dwCountry=this.readUInt16_(t),s.dwLanguage=this.readUInt16_(t),s.dwDialect=this.readUInt16_(t),s.dwCodePage=this.readUInt16_(t),s.value=""):s.value=this.readZSTR_(t,this.head),this.LIST[this.LIST.length-1].subChunks.push(s)}readLISTINFOSubChunks_(t,e){this.head=e.chunkData.start,this.LIST[this.LIST.length-1].subChunks.push({chunkId:e.chunkId,chunkSize:e.chunkSize,value:this.readZSTR_(t,this.head)})}readJunkChunk_(t){let e=this.findChunk("junk");e&&(this.junk={chunkId:e.chunkId,chunkSize:e.chunkSize,chunkData:[].slice.call(t.slice(e.chunkData.start,e.chunkData.end))})}read_PMXChunk_(t){let e=this.findChunk("_PMX");e&&(this.head=e.chunkData.start,this._PMX.chunkId=e.chunkId,this._PMX.chunkSize=e.chunkSize,this._PMX.value=F(t,this.head,this.head+this._PMX.chunkSize))}readZSTR_(t,e=0){for(let s=e;s<t.length&&(this.head++,0!==t[s]);s++);return F(t,e,this.head-1)}readUInt16_(t){let e=E(t,this.uInt16,this.head);return this.head+=2,e}}function W(t,e){let s=D(t);for(let t=s.length;t<e;t++)s.push(0);return s}class H extends N{toBuffer(){this.uInt16.be="RIFX"===this.container,this.uInt32.be=this.uInt16.be;let t=[this.getJunkBytes_(),this.getDs64Bytes_(),this.getBextBytes_(),this.getiXMLBytes_(),this.getFmtBytes_(),this.getFactBytes_(),D(this.data.chunkId),O(this.data.samples.length,this.uInt32),this.data.samples,this.getCueBytes_(),this.getSmplBytes_(),this.getLISTBytes_(),this.get_PMXBytes_()],e=0;for(let s=0;s<t.length;s++)e+=t[s].length;let s=new Uint8Array(e+12),i=0;i=B(this.container,s,i),i=R(e+4,this.uInt32,s,i),i=B(this.format,s,i);for(let e=0;e<t.length;e++)s.set(t[e],i),i+=t[e].length;return s}getBextBytes_(){let t=[];return this.enforceBext_(),this.bext.chunkId&&(this.bext.chunkSize=602+this.bext.codingHistory.length,t=t.concat(D(this.bext.chunkId),O(602+this.bext.codingHistory.length,this.uInt32),W(this.bext.description,256),W(this.bext.originator,32),W(this.bext.originatorReference,32),W(this.bext.originationDate,10),W(this.bext.originationTime,8),O(this.bext.timeReference[0],this.uInt32),O(this.bext.timeReference[1],this.uInt32),O(this.bext.version,this.uInt16),W(this.bext.UMID,64),O(this.bext.loudnessValue,this.uInt16),O(this.bext.loudnessRange,this.uInt16),O(this.bext.maxTruePeakLevel,this.uInt16),O(this.bext.maxMomentaryLoudness,this.uInt16),O(this.bext.maxShortTermLoudness,this.uInt16),W(this.bext.reserved,180),W(this.bext.codingHistory,this.bext.codingHistory.length))),this.enforceByteLen_(t),t}enforceBext_(){for(let t in this.bext)if(this.bext.hasOwnProperty(t)&&this.bext[t]&&"timeReference"!=t){this.bext.chunkId="bext";break}(this.bext.timeReference[0]||this.bext.timeReference[1])&&(this.bext.chunkId="bext")}getiXMLBytes_(){let t=[];if(this.iXML.chunkId){let e=D(this.iXML.value);this.iXML.chunkSize=e.length,t=t.concat(D(this.iXML.chunkId),O(this.iXML.chunkSize,this.uInt32),e)}return this.enforceByteLen_(t),t}getDs64Bytes_(){let t=[];return this.ds64.chunkId&&(t=t.concat(D(this.ds64.chunkId),O(this.ds64.chunkSize,this.uInt32),O(this.ds64.riffSizeHigh,this.uInt32),O(this.ds64.riffSizeLow,this.uInt32),O(this.ds64.dataSizeHigh,this.uInt32),O(this.ds64.dataSizeLow,this.uInt32),O(this.ds64.originationTime,this.uInt32),O(this.ds64.sampleCountHigh,this.uInt32),O(this.ds64.sampleCountLow,this.uInt32))),this.enforceByteLen_(t),t}getCueBytes_(){let t=[];if(this.cue.chunkId){let e=this.getCuePointsBytes_();t=t.concat(D(this.cue.chunkId),O(e.length+4,this.uInt32),O(this.cue.dwCuePoints,this.uInt32),e)}return this.enforceByteLen_(t),t}getCuePointsBytes_(){let t=[];for(let e=0;e<this.cue.dwCuePoints;e++)t=t.concat(O(this.cue.points[e].dwName,this.uInt32),O(this.cue.points[e].dwPosition,this.uInt32),D(this.cue.points[e].fccChunk),O(this.cue.points[e].dwChunkStart,this.uInt32),O(this.cue.points[e].dwBlockStart,this.uInt32),O(this.cue.points[e].dwSampleOffset,this.uInt32));return t}getSmplBytes_(){let t=[];if(this.smpl.chunkId){let e=this.getSmplLoopsBytes_();t=t.concat(D(this.smpl.chunkId),O(e.length+36,this.uInt32),O(this.smpl.dwManufacturer,this.uInt32),O(this.smpl.dwProduct,this.uInt32),O(this.smpl.dwSamplePeriod,this.uInt32),O(this.smpl.dwMIDIUnityNote,this.uInt32),O(this.smpl.dwMIDIPitchFraction,this.uInt32),O(this.smpl.dwSMPTEFormat,this.uInt32),O(this.smpl.dwSMPTEOffset,this.uInt32),O(this.smpl.dwNumSampleLoops,this.uInt32),O(this.smpl.dwSamplerData,this.uInt32),e)}return this.enforceByteLen_(t),t}getSmplLoopsBytes_(){let t=[];for(let e=0;e<this.smpl.dwNumSampleLoops;e++)t=t.concat(O(this.smpl.loops[e].dwName,this.uInt32),O(this.smpl.loops[e].dwType,this.uInt32),O(this.smpl.loops[e].dwStart,this.uInt32),O(this.smpl.loops[e].dwEnd,this.uInt32),O(this.smpl.loops[e].dwFraction,this.uInt32),O(this.smpl.loops[e].dwPlayCount,this.uInt32));return t}getFactBytes_(){let t=[];return this.fact.chunkId&&(t=t.concat(D(this.fact.chunkId),O(this.fact.chunkSize,this.uInt32),O(this.fact.dwSampleLength,this.uInt32))),this.enforceByteLen_(t),t}getFmtBytes_(){let t=[];if(this.fmt.chunkId){let e=t.concat(D(this.fmt.chunkId),O(this.fmt.chunkSize,this.uInt32),O(this.fmt.audioFormat,this.uInt16),O(this.fmt.numChannels,this.uInt16),O(this.fmt.sampleRate,this.uInt32),O(this.fmt.byteRate,this.uInt32),O(this.fmt.blockAlign,this.uInt16),O(this.fmt.bitsPerSample,this.uInt16),this.getFmtExtensionBytes_());return this.enforceByteLen_(e),e}throw Error('Could not find the "fmt " chunk')}getFmtExtensionBytes_(){let t=[];return this.fmt.chunkSize>16&&(t=t.concat(O(this.fmt.cbSize,this.uInt16))),this.fmt.chunkSize>18&&(t=t.concat(O(this.fmt.validBitsPerSample,this.uInt16))),this.fmt.chunkSize>20&&(t=t.concat(O(this.fmt.dwChannelMask,this.uInt32))),this.fmt.chunkSize>24&&(t=t.concat(O(this.fmt.subformat[0],this.uInt32),O(this.fmt.subformat[1],this.uInt32),O(this.fmt.subformat[2],this.uInt32),O(this.fmt.subformat[3],this.uInt32))),t}getLISTBytes_(){let t=[];for(let e=0;e<this.LIST.length;e++){let s=this.getLISTSubChunksBytes_(this.LIST[e].subChunks,this.LIST[e].format);t=t.concat(D(this.LIST[e].chunkId),O(s.length+4,this.uInt32),D(this.LIST[e].format),s)}return this.enforceByteLen_(t),t}getLISTSubChunksBytes_(t,e){let s=[];for(let i=0,n=t.length;i<n;i++)"INFO"==e?s=s.concat(this.getLISTINFOSubChunksBytes_(t[i])):"adtl"==e&&(s=s.concat(this.getLISTadtlSubChunksBytes_(t[i]))),this.enforceByteLen_(s);return s}getLISTINFOSubChunksBytes_(t){let e=[],s=W(t.value,t.value.length);return e=e.concat(D(t.chunkId),O(s.length+1,this.uInt32),s),e.push(0),e}getLISTadtlSubChunksBytes_(t){let e=[];if(["labl","note"].indexOf(t.chunkId)>-1){let s=W(t.value,t.value.length);e=e.concat(D(t.chunkId),O(s.length+4+1,this.uInt32),O(t.dwName,this.uInt32),s),e.push(0)}else"ltxt"==t.chunkId&&(e=e.concat(this.getLtxtChunkBytes_(t)));return e}getLtxtChunkBytes_(t){return[].concat(D(t.chunkId),O(t.value.length+20,this.uInt32),O(t.dwName,this.uInt32),O(t.dwSampleLength,this.uInt32),O(t.dwPurposeID,this.uInt32),O(t.dwCountry,this.uInt16),O(t.dwLanguage,this.uInt16),O(t.dwDialect,this.uInt16),O(t.dwCodePage,this.uInt16),W(t.value,t.value.length))}get_PMXBytes_(){let t=[];if(this._PMX.chunkId){let e=D(this._PMX.value);this._PMX.chunkSize=e.length,t=t.concat(D(this._PMX.chunkId),O(this._PMX.chunkSize,this.uInt32),e)}return this.enforceByteLen_(t),t}getJunkBytes_(){let t=[];return this.junk.chunkId?t.concat(D(this.junk.chunkId),O(this.junk.chunkData.length,this.uInt32),this.junk.chunkData):(this.enforceByteLen_(t),t)}enforceByteLen_(t){t.length%2&&t.push(0)}}function $(t,e,s){return!(s<1||t*(e/8)*s>4294967295)}class V extends H{constructor(){super(),this.bitDepth="0",this.dataType={bits:0,be:!1},this.WAV_AUDIO_FORMATS={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3}}fromScratch(t,e,s,i,n){n=n||{},this.clearHeaders(),this.newWavFile_(t,e,s,i,n)}fromBuffer(t,e=!0){super.fromBuffer(t,e),this.bitDepthFromFmt_(),this.updateDataType_()}toBuffer(){return this.validateWavHeader_(),super.toBuffer()}getSamples(t=!1,e=Float64Array){let s=new e(this.data.samples.length/(this.dataType.bits/8));return U(this.data.samples,this.dataType,s,0,this.data.samples.length),!t&&this.fmt.numChannels>1?function(t,e,s=Float64Array){let i=[];for(let n=0;n<e;n++)i[n]=new s(t.length/e);for(let s=0;s<e;s++)for(let n=s,h=0;n<t.length;n+=e,h++)i[s][h]=t[n];return i}(s,this.fmt.numChannels,e):s}getSample(t){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return E(this.data.samples.slice(t,t+this.dataType.bits/8),this.dataType)}setSample(t,e){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");R(e,this.dataType,this.data.samples,t)}getiXML(){return this.iXML.value}setiXML(t){if("string"!=typeof t)throw new TypeError("iXML value must be a string.");this.iXML.value=t,this.iXML.chunkId="iXML"}get_PMX(){return this._PMX.value}set_PMX(t){if("string"!=typeof t)throw new TypeError("_PMX value must be a string.");this._PMX.value=t,this._PMX.chunkId="_PMX"}newWavFile_(t,e,s,i,n){n.container||(n.container="RIFF"),this.container=n.container,this.bitDepth=s,i=function(t){let e=[];if(t.length>0)if(t[0].constructor!==Number){e=new Float64Array(t[0].length*t.length);for(let s=0,i=t[0].length,n=0;s<i;s++)for(let i=0,h=t.length;i<h;i++,n++)e[n]=t[i][s]}else e=t;return e}(i),this.updateDataType_();let h=this.dataType.bits/8;this.data.samples=new Uint8Array(i.length*h),A(i,this.dataType,this.data.samples,0),this.makeWavHeader_(s,t,e,h,this.data.samples.length,n),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,this.validateWavHeader_()}makeWavHeader_(t,e,s,i,n,h){"4"==t?this.createADPCMHeader_(t,e,s,i,n,h):"8a"==t||"8m"==t?this.createALawMulawHeader_(t,e,s,i,n,h):-1==Object.keys(this.WAV_AUDIO_FORMATS).indexOf(t)||e>2?this.createExtensibleHeader_(t,e,s,i,n,h):this.createPCMHeader_(t,e,s,i,n,h)}createPCMHeader_(t,e,s,i,n,h){this.container=h.container,this.chunkSize=36+n,this.format="WAVE",this.bitDepth=t,this.fmt={chunkId:"fmt ",chunkSize:16,audioFormat:this.WAV_AUDIO_FORMATS[t]||65534,numChannels:e,sampleRate:s,byteRate:e*i*s,blockAlign:e*i,bitsPerSample:parseInt(t,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}createADPCMHeader_(t,e,s,i,n,h){this.createPCMHeader_(t,e,s,i,n,h),this.chunkSize=40+n,this.fmt.chunkSize=20,this.fmt.byteRate=4055,this.fmt.blockAlign=256,this.fmt.bitsPerSample=4,this.fmt.cbSize=2,this.fmt.validBitsPerSample=505,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*n}}createExtensibleHeader_(t,e,s,i,n,h){this.createPCMHeader_(t,e,s,i,n,h),this.chunkSize=60+n,this.fmt.chunkSize=40,this.fmt.bitsPerSample=1+(parseInt(t,10)-1|7),this.fmt.cbSize=22,this.fmt.validBitsPerSample=parseInt(t,10),this.fmt.dwChannelMask=function(t){let e=0;return 1===t?e=4:2===t?e=3:4===t?e=51:6===t?e=63:8===t&&(e=1599),e}(e),this.fmt.subformat=[1,1048576,2852126848,1905997824]}createALawMulawHeader_(t,e,s,i,n,h){this.createPCMHeader_(t,e,s,i,n,h),this.chunkSize=40+n,this.fmt.chunkSize=20,this.fmt.cbSize=2,this.fmt.validBitsPerSample=8,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:n}}bitDepthFromFmt_(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}validateBitDepth_(){if(!this.WAV_AUDIO_FORMATS[this.bitDepth]){if(parseInt(this.bitDepth,10)>8&&parseInt(this.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}return!0}updateDataType_(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),fp:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}validateWavHeader_(){if(this.validateBitDepth_(),t=this.fmt.numChannels,e=this.fmt.bitsPerSample,t<1||t*e/8>65535)throw new Error("Invalid number of channels.");var t,e;if(!$(this.fmt.numChannels,this.fmt.bitsPerSample,this.fmt.sampleRate))throw new Error("Invalid sample rate.")}}class G extends V{getTag(t){let e=this.getTagIndex_(t);return null!==e.TAG?this.LIST[e.LIST].subChunks[e.TAG].value:null}setTag(t,e){t=function(t){if(t.constructor!==String)throw new Error("Invalid tag name.");if(t.length<4)for(let e=0,s=4-t.length;e<s;e++)t+=" ";return t}(t);let s=this.getTagIndex_(t);null!==s.TAG?(this.LIST[s.LIST].subChunks[s.TAG].chunkSize=e.length+1,this.LIST[s.LIST].subChunks[s.TAG].value=e):null!==s.LIST?this.LIST[s.LIST].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}):(this.LIST.push({chunkId:"LIST",chunkSize:8+e.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}))}deleteTag(t){let e=this.getTagIndex_(t);return null!==e.TAG&&(this.LIST[e.LIST].subChunks.splice(e.TAG,1),!0)}listTags(){let t=this.getLISTIndex("INFO"),e={};if(null!==t)for(let s=0,i=this.LIST[t].subChunks.length;s<i;s++)e[this.LIST[t].subChunks[s].chunkId]=this.LIST[t].subChunks[s].value;return e}getLISTIndex(t){for(let e=0,s=this.LIST.length;e<s;e++)if(this.LIST[e].format==t)return e;return null}getTagIndex_(t){let e={LIST:null,TAG:null};for(let s=0,i=this.LIST.length;s<i;s++)if("INFO"==this.LIST[s].format){e.LIST=s;for(let i=0,n=this.LIST[s].subChunks.length;i<n;i++)if(this.LIST[s].subChunks[i].chunkId==t){e.TAG=i;break}break}return e}}class Z extends G{listCuePoints(){let t=this.getCuePoints_();for(let e=0,s=t.length;e<s;e++)t[e].position=t[e].dwSampleOffset/this.fmt.sampleRate*1e3,t[e].dwSampleLength?(t[e].end=t[e].dwSampleLength/this.fmt.sampleRate*1e3,t[e].end+=t[e].position):t[e].end=null,delete t[e].value;return t}setCuePoint(t){this.cue.chunkId="cue ",t.label||(t.label="");let e=this.getCuePoints_();this.clearLISTadtl_(),this.cue.points=[],t.dwSampleOffset=t.position*this.fmt.sampleRate/1e3,t.dwSampleLength=0,t.end&&(t.dwSampleLength=t.end*this.fmt.sampleRate/1e3-t.dwSampleOffset),0===e.length?this.setCuePoint_(t,1):this.setCuePointInOrder_(e,t),this.cue.dwCuePoints=this.cue.points.length}deleteCuePoint(t){this.cue.chunkId="cue ";let e=this.getCuePoints_();this.clearLISTadtl_();let s=this.cue.points.length;this.cue.points=[];for(let i=0;i<s;i++)i+1!==t&&this.setCuePoint_(e[i],i+1);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}updateLabel(t,e){let s=this.getLISTIndex("adtl");if(null!==s)for(let i=0,n=this.LIST[s].subChunks.length;i<n;i++)this.LIST[s].subChunks[i].dwName==t&&(this.LIST[s].subChunks[i].value=e)}getCuePoints_(){let t=[];for(let e=0;e<this.cue.points.length;e++){let s=this.cue.points[e],i=this.getDataForCuePoint_(s.dwName);i.label=i.value?i.value:"",i.dwPosition=s.dwPosition,i.fccChunk=s.fccChunk,i.dwChunkStart=s.dwChunkStart,i.dwBlockStart=s.dwBlockStart,i.dwSampleOffset=s.dwSampleOffset,t.push(i)}return t}getDataForCuePoint_(t){let e=this.getLISTIndex("adtl"),s={};return null!==e&&this.getCueDataFromLIST_(s,e,t),s}getCueDataFromLIST_(t,e,s){for(let i=0,n=this.LIST[e].subChunks.length;i<n;i++)if(this.LIST[e].subChunks[i].dwName==s){let s=this.LIST[e].subChunks[i];t.value=s.value||t.value,t.dwName=s.dwName||0,t.dwSampleLength=s.dwSampleLength||0,t.dwPurposeID=s.dwPurposeID||0,t.dwCountry=s.dwCountry||0,t.dwLanguage=s.dwLanguage||0,t.dwDialect=s.dwDialect||0,t.dwCodePage=s.dwCodePage||0}}setCuePoint_(t,e){this.cue.points.push({dwName:e,dwPosition:t.dwPosition?t.dwPosition:0,fccChunk:t.fccChunk?t.fccChunk:"data",dwChunkStart:t.dwChunkStart?t.dwChunkStart:0,dwBlockStart:t.dwBlockStart?t.dwBlockStart:0,dwSampleOffset:t.dwSampleOffset}),this.setLabl_(t,e)}setCuePointInOrder_(t,e){let s=!1;for(let i=0;i<t.length;i++)t[i].dwSampleOffset>e.dwSampleOffset&&!s?(this.setCuePoint_(e,i+1),this.setCuePoint_(t[i],i+2),s=!0):this.setCuePoint_(t[i],s?i+2:i+1);s||this.setCuePoint_(e,this.cue.points.length+1)}clearLISTadtl_(){for(let t=0,e=this.LIST.length;t<e;t++)"adtl"==this.LIST[t].format&&this.LIST.splice(t)}setLabl_(t,e){let s=this.getLISTIndex("adtl");null===s&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),s=this.LIST.length-1),this.setLabelText_(s,t,e),t.dwSampleLength&&this.setLtxtChunk_(s,t,e)}setLabelText_(t,e,s){this.LIST[t].subChunks.push({chunkId:"labl",chunkSize:4,dwName:s,value:e.label}),this.LIST[t].chunkSize+=12}setLtxtChunk_(t,e,s){this.LIST[t].subChunks.push({chunkId:"ltxt",chunkSize:20,dwName:s,dwSampleLength:e.dwSampleLength,dwPurposeID:e.dwPurposeID||0,dwCountry:e.dwCountry||0,dwLanguage:e.dwLanguage||0,dwDialect:e.dwDialect||0,dwCodePage:e.dwCodePage||0,value:e.label}),this.LIST[t].chunkSize+=28}}class J{constructor(t,e,s){this.length_=t,this.scaleFactor_=(t-1)/e,this.interpolate=this.sinc,"point"===s.method?this.interpolate=this.point:"linear"===s.method?this.interpolate=this.linear:"cubic"===s.method&&(this.interpolate=this.cubic),this.tangentFactor_=1-Math.max(0,Math.min(1,s.tension||0)),this.sincFilterSize_=s.sincFilterSize||1,this.kernel_=function(t){return function(e){return function(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}(e)*t(e)}}(s.sincWindow||Q)}point(t,e){return this.getClippedInput_(Math.round(this.scaleFactor_*t),e)}linear(t,e){t=this.scaleFactor_*t;let s=Math.floor(t);return(1-(t-=s))*this.getClippedInput_(s,e)+t*this.getClippedInput_(s+1,e)}cubic(t,e){t=this.scaleFactor_*t;let s=Math.floor(t),i=[this.getTangent_(s,e),this.getTangent_(s+1,e)],n=[this.getClippedInput_(s,e),this.getClippedInput_(s+1,e)],h=(t-=s)*t,r=t*h;return(2*r-3*h+1)*n[0]+(r-2*h+t)*i[0]+(-2*r+3*h)*n[1]+(r-h)*i[1]}sinc(t,e){t=this.scaleFactor_*t;let s=Math.floor(t),i=s-this.sincFilterSize_+1,n=s+this.sincFilterSize_,h=0;for(let s=i;s<=n;s++)h+=this.kernel_(t-s)*this.getClippedInput_(s,e);return h}getTangent_(t,e){return this.tangentFactor_*(this.getClippedInput_(t+1,e)-this.getClippedInput_(t-1,e))/2}getClippedInput_(t,e){return 0<=t&&t<this.length_?e[t]:0}}function Q(t){return Math.exp(-t/2*t/2)}const q={point:!1,linear:!1,cubic:!0,sinc:!0},K={IIR:16,FIR:71},Y={IIR:class{constructor(t,e,s){let i=[];for(let n=0;n<t;n++)i.push(this.getCoeffs_({Fs:e,Fc:s,Q:.5/Math.sin(Math.PI/(2*t)*(n+.5))}));this.stages=[];for(let t=0;t<i.length;t++)this.stages[t]={b0:i[t].b[0],b1:i[t].b[1],b2:i[t].b[2],a1:i[t].a[0],a2:i[t].a[1],k:i[t].k,z:[0,0]}}filter(t){let e=t;for(let t=0,s=this.stages.length;t<s;t++)e=this.runStage_(t,e);return e}getCoeffs_(t){let e={a:[],b:[]},s=this.preCalc_(t,e);return e.k=1,e.b.push((1-s.cw)/(2*s.a0)),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e}preCalc_(t,e){let s={},i=2*Math.PI*t.Fc/t.Fs;return s.alpha=Math.sin(i)/(2*t.Q),s.cw=Math.cos(i),s.a0=1+s.alpha,e.a0=s.a0,e.a.push(-2*s.cw/s.a0),e.k=1,e.a.push((1-s.alpha)/s.a0),s}runStage_(t,e){let s=e*this.stages[t].k-this.stages[t].a1*this.stages[t].z[0]-this.stages[t].a2*this.stages[t].z[1],i=this.stages[t].b0*s+this.stages[t].b1*this.stages[t].z[0]+this.stages[t].b2*this.stages[t].z[1];return this.stages[t].z[1]=this.stages[t].z[0],this.stages[t].z[0]=s,i}reset(){for(let t=0;t<this.stages.length;t++)this.stages[t].z=[0,0]}},FIR:class{constructor(t,e,s){let i=2*Math.PI*s/e,n=0;this.filters=[];for(let e=0;e<=t;e++)e-t/2==0?this.filters[e]=i:(this.filters[e]=Math.sin(i*(e-t/2))/(e-t/2),this.filters[e]*=.54-.46*Math.cos(2*Math.PI*e/t)),n+=this.filters[e];for(let e=0;e<=t;e++)this.filters[e]/=n;this.z=this.initZ_()}filter(t){this.z.buf[this.z.pointer]=t;let e=0;for(let t=0,s=this.z.buf.length;t<s;t++)e+=this.filters[t]*this.z.buf[(this.z.pointer+t)%this.z.buf.length];return this.z.pointer=(this.z.pointer+1)%this.z.buf.length,e}reset(){this.z=this.initZ_()}initZ_(){let t=[];for(let e=0;e<this.filters.length-1;e++)t.push(0);return{buf:t,pointer:0}}}};function tt(t,e,s,i=null){i=i||{};let n=(s-e)/e+1,h=new Float64Array(t.length*n);i.method=i.method||"cubic";let r=new J(t.length,h.length,{method:i.method,tension:i.tension||0,sincFilterSize:i.sincFilterSize||6,sincWindow:i.sincWindow||void 0,clip:i.clip||"mirror"});if(void 0===i.LPF&&(i.LPF=q[i.method]),i.LPF){i.LPFType=i.LPFType||"IIR";const n=Y[i.LPFType];s>e?function(t,e,s,i){for(let n=0,h=e.length;n<h;n++)e[n]=i.filter(s.interpolate(n,t));i.reset();for(let t=e.length-1;t>=0;t--)e[t]=i.filter(e[t])}(t,h,r,new n(i.LPForder||K[i.LPFType],s,e/2)):function(t,e,s,i){for(let e=0,s=t.length;e<s;e++)t[e]=i.filter(t[e]);i.reset();for(let e=t.length-1;e>=0;e--)t[e]=i.filter(t[e]);et(t,e,s)}(t,h,r,new n(i.LPForder||K[i.LPFType],e,s/2))}else et(t,h,r);return h}function et(t,e,s){for(let i=0,n=e.length;i<n;i++)e[i]=s.interpolate(i,t)}class st extends Z{toRIFF(){let t=new Float64Array(it(this.data.samples.length,this.dataType.bits/8));U(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFF"})}toRIFX(){let t=new Float64Array(it(this.data.samples.length,this.dataType.bits/8));U(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFX"})}toIMAADPCM(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");{this.assure16Bit_();let t=new Int16Array(it(this.data.samples.length,2));U(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"4",function(t){let e={index:0,predicted:0,step:7},s=new Uint8Array(t.length),i=[],n=0,h=0;for(let r=0,a=t.length;r<a;r++)r%505==0&&0!=r&&(s.set(p(i,e),n),n+=256,i=[],h++),i.push(t[r]);let r=t.length/2;return r%2&&r++,s.slice(0,r+512+4*h)}(t),{container:this.correctContainer_()})}}fromIMAADPCM(t="16"){let e;if(this.fmt.numChannels>1){if(this.fmt.numChannels>2)throw new Error("Only 1 or 2 channels are supported");let t=this.data.samples.length/2,s=new Uint8Array(t),i=new Uint8Array(t),n=0;for(let e=0;e<t;e++)e&&e%4==0&&(n+=4),s[e]=this.data.samples[n+e],i[e]=this.data.samples[n+e+4];e=[f(s,this.fmt.blockAlign/2),f(i,this.fmt.blockAlign/2)]}else e=f(this.data.samples,this.fmt.blockAlign);this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",e,{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toALaw(){this.assure16Bit_();let t=new Int16Array(it(this.data.samples.length,2));U(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(t){let e=new Uint8Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=k(t[s]);return e}(t),{container:this.correctContainer_()})}fromALaw(t="16"){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=S(t[s]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toMuLaw(){this.assure16Bit_();let t=new Int16Array(it(this.data.samples.length,2));U(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(t){let e=new Uint8Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=y(t[s]);return e}(t),{container:this.correctContainer_()})}fromMuLaw(t="16"){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=C(t[s]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toBitDepth(t,e=!0){let s=t,i=this.bitDepth;e||("32f"!=t&&(s=this.dataType.bits.toString()),i=""+this.dataType.bits),this.assureUncompressed_();let n=this.getSamples(!0),h=new Float64Array(n.length);(function(t,e,s,i){if(["32f","64"].indexOf(e)>-1&&["32f","64"].indexOf(i)>-1)return void s.set(t);o(e),o(i);let n=function(t,e){let s=function(t){return t};return t!=e&&(s=["32f","64"].includes(t)?a:["32f","64"].includes(e)?u:r),s}(e,i),h={oldMin:Math.pow(2,parseInt(e,10))/2,newMin:Math.pow(2,parseInt(i,10))/2,oldMax:Math.pow(2,parseInt(e,10))/2-1,newMax:Math.pow(2,parseInt(i,10))/2-1};l(e,t,!0);for(let e=0,i=t.length;e<i;e++)s[e]=n(t[e],h);l(i,s,!1)})(n,i,h,s),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,t,h,{container:this.correctContainer_()})}toSampleRate(t,e){this.validateResample_(t);let s=this.getSamples(),i=[];if(s.constructor===Float64Array)i=tt(s,this.fmt.sampleRate,t,e);else for(let n=0;n<s.length;n++)i.push(tt(s[n],this.fmt.sampleRate,t,e));this.fromExisting_(this.fmt.numChannels,t,this.bitDepth,i,{container:this.correctContainer_()})}validateResample_(t){if(!$(this.fmt.numChannels,this.fmt.bitsPerSample,t))throw new Error("Invalid sample rate.");if(["4","8a","8m"].indexOf(this.bitDepth)>-1)throw new Error("wavefile can't change the sample rate of compressed files.")}assure16Bit_(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}assureUncompressed_(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}correctContainer_(){return"RF64"==this.container?"RIFF":this.container}fromExisting_(t,e,s,i,n){let h=new Z;Object.assign(this.fmt,h.fmt),Object.assign(this.fact,h.fact),Object.assign(this.ds64,h.ds64),Object.assign(this.data,h.data),this.newWavFile_(t,e,s,i,n)}}function it(t,e){let s=t/e;return s%2&&s++,s}class nt extends st{constructor(t){super(),t&&this.fromBuffer(t)}fromBase64(t){this.fromBuffer(function(t){let e=new Uint8Array(256);for(let t=0;t<h.length;t++)e[h.charCodeAt(t)]=t;let s=.75*t.length;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);let i=new Uint8Array(s);for(let s=0,n=0;s<t.length;s+=4){let h=e[t.charCodeAt(s)],r=e[t.charCodeAt(s+1)],a=e[t.charCodeAt(s+2)],u=e[t.charCodeAt(s+3)];i[n++]=h<<2|r>>4,i[n++]=(15&r)<<4|a>>2,i[n++]=(3&a)<<6|63&u}return i}(t))}toBase64(){return function(t){let e="";for(let s=0;s<t.length;s+=3)e+=h[t[s]>>2],e+=h[(3&t[s])<<4|t[s+1]>>4],e+=h[(15&t[s+1])<<2|t[s+2]>>6],e+=h[63&t[s+2]];return t.length%3==2?e=e.substring(0,e.length-1)+"=":t.length%3==1&&(e=e.substring(0,e.length-2)+"=="),e}(this.toBuffer())}toDataURI(){return"data:audio/wav;base64,"+this.toBase64()}fromDataURI(t){this.fromBase64(t.replace("data:audio/wav;base64,",""))}}function ht(t){let e=t.length,s=new Uint8Array(e);for(let i=0;i<e;i++)s[i]=t.charCodeAt(i);return s}e({async decodeWav(t){let e="string"==typeof t?ht(class{static encode(t){return void 0!==globalThis.btoa?globalThis.btoa(t):Buffer.from(t,"binary").toString("base64")}static decode(t){return void 0!==globalThis.atob?globalThis.atob(t):Buffer.from(t,"base64").toString("binary")}static isBase64(t){return!!t.match(/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/)}}.decode(t)):t,s=new nt(e);return"4"===s.bitDepth&&s.fromIMAADPCM(),s.toBuffer()},async generateVxlGeometry(t,e){let i=await s.e(966).then(s.bind(s,998)),h=await i.generateVxlGeometry(t,e);return n(h,h)},async compressFile(t,e){importScripts("../lib/system.js"),SystemJS.config({paths:{"7z-wasm":"../dist/7zz.js"}});let s,i=await SystemJS.import("7z-wasm"),n=await i({quit:t=>{s=t}});n.FS.chdir("/tmp");let h="string"==typeof t?ht(t):t,r=e+".7z",a=n.FS.open(e,"w+");if(n.FS.write(a,h,0,h.length),n.FS.close(a),n.callMain(["a",r,e]),s)throw new Error("State dump archiving failed");n.FS.unlink(e);try{let t=n.FS.readFile(r);return n.FS.unlink(r),t}catch(t){if("ENOENT"===t.code)throw new Error("Compressed file not found");throw t}}})})()})();